<h4 class="text-center">投稿内容編集</h4>
<%= form_with model: @post, url: post_path(@post.id), method: :patch do |f| %>
  <table class="tb01 mx-auto">
  <tr>
    <th>画像を選択</th>
    <td><%= f.file_field :image, accept:"image/*" %></td>
  </tr>
  <tr>
    <th>商品名</th>
    <td><%= f.text_field :name, placeholder:"商品名" %></td>
  </tr>
  <tr>
    <th>価格</th>
    <td><%= f.text_field :price, placeholder:"価格（税込）" %></td>
  </tr>
  <tr>
    <th>評価</th>
    <td>
<!--raty.jsにて星を表示-->
    <div class="form-group" id="star">
      <%= f.label :star %>
      <%= f.hidden_field :star, id: :review_star, class: 'form-control' %>
      <div id="post_raty"></div>
    </div>
    <script>
      $(document).on('turbolinks:load', function() {
        let elem = document.querySelector('#post_raty');
        if (elem == null) return;
  
        elem.innerHTML = ""
        let opt = {  
          starOn: "<%= asset_path('star-on.png') %>",
          starOff: "<%= asset_path('star-off.png') %>",
          starHalf: "<%= asset_path('star-half.png') %>",
          scoreName: 'post[star]',
        };
        raty(elem, opt);
      });
    </script>
   </td>
  </tr>
<script>
var elem = document.getElementById('star')
　　elem.innerHTML = '';
　　raty(elem,{
    size     : 36,
    starOff: '<%= asset_path('star-off.png') %>',
    starOn : '<%= asset_path('star-on.png') %>',
    starHalf: '<%= asset_path('star-half.png') %>',
    scoreName: 'post[star]',
    half: true,
  });
</script>
<!--星表示ここまで-->

  <!--モーダルウィンドウにてタグ選択画面を表示-->
  <tr>
    <th>タグを選択</th>
    <td>
      <div class="modal-open btn btn-primary">タグ選択画面</div>
      <div class="modal-container">
        <div class="modal-body">
          <div class="modal-close">×</div>
          <div class="modal-content">
            <% @tag_genres.each do |tag_genre| %>
              <%= tag_genre.name %>
              <%= f.collection_check_boxes(:tag_ids, Tag.where(tag_genre_id: tag_genre.id), :id, :name) do |tag| %>
                <%= tag.check_box %>
                <%= tag.text %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </td>
  </tr>
    <!--モーダルウィンドウでのタグ表示ここまで-->
  <tr>
    <th>店舗を検索</th>
    <td>
      <%= link_to '店舗を検索', shops_search_path, class:"btn btn-primary" %>
      <% if params[:select_shop].present? %>
        <%= image_tag @shop.dig('photo', 'pc', 's') %> 店名：<%= @shop["name"] %> : 住所：<%= @shop["address"] %>
        <%= f.hidden_field :shop_id, value: @shop["id"] %>
        <%= f.hidden_field :shop_large_area, value: @shop["large_area"]["name"] %>
        <%= f.hidden_field :shop_midnight_meal, value: @shop['midnight_meal'] %>
      <% end %>
    </td>
  </tr>
</table>
  <%= f.submit '変更して投稿', class:"btn btn-lg btn-info mt-4 px-5" %>
<% end %>
<script>
  $(function(){
  // 変数に要素を入れる
  var open = $('.modal-open'),
    close = $('.modal-close'),
    container = $('.modal-container');

  //開くボタンをクリックしたらモーダルを表示する
  open.on('click',function(){ 
    container.addClass('active');
    return false;
  });

  //閉じるボタンをクリックしたらモーダルを閉じる
  close.on('click',function(){  
    container.removeClass('active');
  });

  //モーダルの外側をクリックしたらモーダルを閉じる
  $(document).on('click',function(e) {
    if(!$(e.target).closest('.modal-body').length) {
      container.removeClass('active');
    }
  });
});
</script>